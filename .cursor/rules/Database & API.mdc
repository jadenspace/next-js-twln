# TWLN 프로젝트 데이터베이스 및 API 가이드

## 데이터베이스 설계

### Supabase PostgreSQL 설정

- 관계형 데이터베이스 구조
- Row Level Security (RLS) 정책 적용
- 실시간 구독 기능 활용
- 자동 백업 및 복구

### 주요 테이블 구조

#### users 테이블

- 사용자 기본 정보 저장
- Supabase Auth와 연동
- 프로필 정보 포함

#### approved_users 테이블

- 승인된 사용자 목록
- 승인 일시 및 승인자 정보
- 활성 상태 관리

#### user_profiles 테이블

- 사용자 상세 프로필 정보
- 아바타 URL 및 개인정보
- 승인 상태 정보

### 데이터베이스 보안

- RLS 정책을 통한 데이터 접근 제어
- 사용자별 데이터 격리
- 관리자 권한 분리
- 감사 로그 기록

## API 설계 패턴

### RESTful API 원칙

- 리소스 기반 URL 구조
- HTTP 메서드 적절한 사용
- 상태 코드 표준화
- 일관된 응답 형식

### API 레이어 구조

- `src/features/*/api/`: 기능별 API 모듈
- `src/shared/api/`: 공통 API 설정
- 타입 안전한 API 클라이언트
- 에러 처리 표준화

### API 응답 형식

```typescript
// 성공 응답
{
  data: T,
  message?: string
}

// 에러 응답
{
  error: string,
  code?: string,
  details?: any
}
```

## TanStack Query 활용

### 쿼리 키 전략

- 계층적 쿼리 키 구조
- 쿼리 무효화 전략
- 백그라운드 동기화
- 캐싱 전략

### 뮤테이션 패턴

- 낙관적 업데이트
- 에러 롤백 처리
- 쿼리 무효화
- 로딩 상태 관리

### 에러 처리

- 전역 에러 핸들러
- 재시도 정책
- 폴백 UI 표시
- 에러 로깅

## 실시간 기능

### Supabase Realtime

- 데이터베이스 변경사항 실시간 구독
- 사용자별 알림 시스템
- 협업 기능 구현
- 연결 상태 관리

### WebSocket 연결

- 자동 재연결 처리
- 연결 상태 모니터링
- 에러 처리 및 복구
- 성능 최적화

## 데이터 모델링

### 엔티티 설계

- 도메인 모델 중심 설계
- 관계형 데이터 모델링
- 정규화 및 비정규화 고려
- 확장성 고려

### 타입 정의

- TypeScript 타입 안전성
- 런타임 타입 검증
- API 응답 타입 정의
- 데이터 변환 로직

## 성능 최적화

### 데이터베이스 최적화

- 인덱스 최적화
- 쿼리 성능 튜닝
- 연결 풀 관리
- 캐싱 전략

### API 성능

- 응답 시간 최적화
- 배치 처리 구현
- 페이지네이션 적용
- 압축 및 최적화

### 클라이언트 최적화

- 데이터 페칭 최적화
- 불필요한 요청 제거
- 캐싱 활용
- 백그라운드 동기화
